<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šç´šç·©å­˜æ¶æ§‹ - API æ¸¬è©¦é é¢</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        .content {
            padding: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.healthy {
            background: #d4edda;
            color: #155724;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ å¤šç´šç·©å­˜æ¶æ§‹ - API æ¸¬è©¦é é¢</h1>
            <p>Spring Boot 3.2 + Java 17 + MySQL + MyBatis Plus + Caffeine + Redis</p>
        </div>
        
        <div class="content">
            <!-- ç³»çµ±ç›£æ§ -->
            <div class="section">
                <h3>ğŸ“Š ç³»çµ±ç›£æ§</h3>
                <div class="grid">
                    <div>
                        <button onclick="getPerformanceStats()">ç²å–æ€§èƒ½çµ±è¨ˆ</button>
                        <button onclick="getCacheStats()">ç²å–ç·©å­˜çµ±è¨ˆ</button>
                    </div>
                    <div>
                        <button onclick="getSystemHealth()">ç³»çµ±å¥åº·æª¢æŸ¥</button>
                        <button onclick="clearStats()">æ¸…ç†çµ±è¨ˆæ•¸æ“š</button>
                    </div>
                </div>
                <div id="monitorResult" class="result"></div>
            </div>

            <!-- äº¤æ˜“è¨˜éŒ„æ¸¬è©¦ -->
            <div class="section">
                <h3>ğŸ’³ äº¤æ˜“è¨˜éŒ„æ¸¬è©¦</h3>
                <div class="grid">
                    <div>
                        <div class="form-group">
                            <label>äº¤æ˜“ID:</label>
                            <input type="text" id="transactionId" placeholder="ä¾‹å¦‚: TXN000001">
                        </div>
                        <button onclick="getTransaction()">æŸ¥è©¢äº¤æ˜“è¨˜éŒ„</button>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>ç”¨æˆ¶ID:</label>
                            <input type="text" id="userId" placeholder="ä¾‹å¦‚: USER001">
                        </div>
                        <button onclick="getUserTransactions()">æŸ¥è©¢ç”¨æˆ¶äº¤æ˜“</button>
                    </div>
                </div>
                <div class="grid">
                    <div>
                        <div class="form-group">
                            <label>è³¬æˆ¶è™Ÿç¢¼:</label>
                            <input type="text" id="accountNumber" placeholder="ä¾‹å¦‚: ACC001">
                        </div>
                        <button onclick="getAccountTransactions()">æŸ¥è©¢è³¬æˆ¶äº¤æ˜“</button>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>é ç¢¼:</label>
                            <input type="number" id="page" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label>é å¤§å°:</label>
                            <input type="number" id="size" value="10" min="1" max="100">
                        </div>
                        <button onclick="getTransactionsByPage()">åˆ†é æŸ¥è©¢</button>
                    </div>
                </div>
                <div id="transactionResult" class="result"></div>
            </div>

            <!-- é»‘åå–®æ¸¬è©¦ -->
            <div class="section">
                <h3>ğŸš« é»‘åå–®æ¸¬è©¦</h3>
                <div class="grid">
                    <div>
                        <div class="form-group">
                            <label>ç”¨æˆ¶ID:</label>
                            <input type="text" id="blacklistUserId" placeholder="ä¾‹å¦‚: USER001">
                        </div>
                        <button onclick="checkUserBlacklist()">æª¢æŸ¥ç”¨æˆ¶é»‘åå–®</button>
                        <button onclick="getUserBlacklist()">æŸ¥è©¢ç”¨æˆ¶é»‘åå–®è¨˜éŒ„</button>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>è³¬æˆ¶è™Ÿç¢¼:</label>
                            <input type="text" id="blacklistAccountNumber" placeholder="ä¾‹å¦‚: ACC001">
                        </div>
                        <button onclick="checkAccountBlacklist()">æª¢æŸ¥è³¬æˆ¶é»‘åå–®</button>
                        <button onclick="getAccountBlacklist()">æŸ¥è©¢è³¬æˆ¶é»‘åå–®è¨˜éŒ„</button>
                    </div>
                </div>
                <div class="grid">
                    <div>
                        <button onclick="getBlacklistsByType()">æŒ‰é¡å‹æŸ¥è©¢é»‘åå–®</button>
                        <button onclick="getActiveBlacklists()">æŸ¥è©¢æœ‰æ•ˆé»‘åå–®</button>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>é»‘åå–®é¡å‹:</label>
                            <select id="blacklistType">
                                <option value="USER">ç”¨æˆ¶é»‘åå–®</option>
                                <option value="ACCOUNT">è³¬æˆ¶é»‘åå–®</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="blacklistResult" class="result"></div>
            </div>

            <!-- æ€§èƒ½æ¸¬è©¦ -->
            <div class="section">
                <h3>âš¡ æ€§èƒ½æ¸¬è©¦</h3>
                <div class="grid">
                    <div>
                        <div class="form-group">
                            <label>ä¸¦ç™¼æ•¸:</label>
                            <input type="number" id="concurrency" value="10" min="1" max="100">
                        </div>
                        <button onclick="testTransactionPerformance()">äº¤æ˜“æ€§èƒ½æ¸¬è©¦</button>
                        <button onclick="testBlacklistPerformance()">é»‘åå–®æ€§èƒ½æ¸¬è©¦</button>
                    </div>
                    <div>
                        <button onclick="testComprehensivePerformance()">ç¶œåˆæ€§èƒ½æ¸¬è©¦</button>
                        <button onclick="clearAllResults()">æ¸…ç©ºæ‰€æœ‰çµæœ</button>
                    </div>
                </div>
                <div id="performanceResult" class="result"></div>
            </div>

            <!-- æ•¸æ“šåˆå§‹åŒ– -->
            <div class="section">
                <h3>ğŸ—„ï¸ æ•¸æ“šåˆå§‹åŒ–</h3>
                <div class="grid">
                    <div>
                        <button onclick="createTransactionTestData()">å‰µå»ºäº¤æ˜“æ¸¬è©¦æ•¸æ“š</button>
                        <button onclick="createBlacklistTestData()">å‰µå»ºé»‘åå–®æ¸¬è©¦æ•¸æ“š</button>
                    </div>
                    <div>
                        <button onclick="checkHealth()">å¥åº·æª¢æŸ¥</button>
                        <button onclick="getAllEndpoints()">ç²å–æ‰€æœ‰ç«¯é»</button>
                    </div>
                </div>
                <div id="initResult" class="result"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';
        
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                const data = await response.json();
                return { success: true, data };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        function displayResult(elementId, result) {
            const element = document.getElementById(elementId);
            if (result.success) {
                element.className = 'result success';
                element.textContent = JSON.stringify(result.data, null, 2);
            } else {
                element.className = 'result error';
                element.textContent = `éŒ¯èª¤: ${result.error}`;
            }
        }

        // ç³»çµ±ç›£æ§åŠŸèƒ½
        async function getPerformanceStats() {
            const result = await makeRequest(`${API_BASE}/monitor/performance`);
            displayResult('monitorResult', result);
        }

        async function getCacheStats() {
            const result = await makeRequest(`${API_BASE}/monitor/cache`);
            displayResult('monitorResult', result);
        }

        async function getSystemHealth() {
            const result = await makeRequest(`${API_BASE}/monitor/health`);
            displayResult('monitorResult', result);
        }

        async function clearStats() {
            const result = await makeRequest(`${API_BASE}/monitor/clear-stats`);
            displayResult('monitorResult', result);
        }

        // äº¤æ˜“è¨˜éŒ„åŠŸèƒ½
        async function getTransaction() {
            const transactionId = document.getElementById('transactionId').value;
            if (!transactionId) {
                alert('è«‹è¼¸å…¥äº¤æ˜“ID');
                return;
            }
            const result = await makeRequest(`${API_BASE}/transactions/${transactionId}`);
            displayResult('transactionResult', result);
        }

        async function getUserTransactions() {
            const userId = document.getElementById('userId').value;
            if (!userId) {
                alert('è«‹è¼¸å…¥ç”¨æˆ¶ID');
                return;
            }
            const result = await makeRequest(`${API_BASE}/transactions/user/${userId}`);
            displayResult('transactionResult', result);
        }

        async function getAccountTransactions() {
            const accountNumber = document.getElementById('accountNumber').value;
            if (!accountNumber) {
                alert('è«‹è¼¸å…¥è³¬æˆ¶è™Ÿç¢¼');
                return;
            }
            const result = await makeRequest(`${API_BASE}/transactions/account/${accountNumber}`);
            displayResult('transactionResult', result);
        }

        async function getTransactionsByPage() {
            const userId = document.getElementById('userId').value;
            const page = document.getElementById('page').value;
            const size = document.getElementById('size').value;
            if (!userId) {
                alert('è«‹è¼¸å…¥ç”¨æˆ¶ID');
                return;
            }
            const result = await makeRequest(`${API_BASE}/transactions/user/${userId}/page?page=${page}&size=${size}`);
            displayResult('transactionResult', result);
        }

        // é»‘åå–®åŠŸèƒ½
        async function checkUserBlacklist() {
            const userId = document.getElementById('blacklistUserId').value;
            if (!userId) {
                alert('è«‹è¼¸å…¥ç”¨æˆ¶ID');
                return;
            }
            const result = await makeRequest(`${API_BASE}/blacklist/check/user/${userId}`);
            displayResult('blacklistResult', result);
        }

        async function checkAccountBlacklist() {
            const accountNumber = document.getElementById('blacklistAccountNumber').value;
            if (!accountNumber) {
                alert('è«‹è¼¸å…¥è³¬æˆ¶è™Ÿç¢¼');
                return;
            }
            const result = await makeRequest(`${API_BASE}/blacklist/check/account/${accountNumber}`);
            displayResult('blacklistResult', result);
        }

        async function getUserBlacklist() {
            const userId = document.getElementById('blacklistUserId').value;
            if (!userId) {
                alert('è«‹è¼¸å…¥ç”¨æˆ¶ID');
                return;
            }
            const result = await makeRequest(`${API_BASE}/blacklist/user/${userId}`);
            displayResult('blacklistResult', result);
        }

        async function getAccountBlacklist() {
            const accountNumber = document.getElementById('blacklistAccountNumber').value;
            if (!accountNumber) {
                alert('è«‹è¼¸å…¥è³¬æˆ¶è™Ÿç¢¼');
                return;
            }
            const result = await makeRequest(`${API_BASE}/blacklist/account/${accountNumber}`);
            displayResult('blacklistResult', result);
        }

        async function getBlacklistsByType() {
            const blacklistType = document.getElementById('blacklistType').value;
            const result = await makeRequest(`${API_BASE}/blacklist/type/${blacklistType}`);
            displayResult('blacklistResult', result);
        }

        async function getActiveBlacklists() {
            const result = await makeRequest(`${API_BASE}/blacklist/active`);
            displayResult('blacklistResult', result);
        }

        // æ€§èƒ½æ¸¬è©¦åŠŸèƒ½
        async function testTransactionPerformance() {
            const concurrency = document.getElementById('concurrency').value;
            const result = await makeRequest(`${API_BASE}/test/transactions?concurrency=${concurrency}`);
            displayResult('performanceResult', result);
        }

        async function testBlacklistPerformance() {
            const concurrency = document.getElementById('concurrency').value;
            const result = await makeRequest(`${API_BASE}/test/blacklist?concurrency=${concurrency}`);
            displayResult('performanceResult', result);
        }

        async function testComprehensivePerformance() {
            const result = await makeRequest(`${API_BASE}/test/comprehensive`);
            displayResult('performanceResult', result);
        }

        // æ•¸æ“šåˆå§‹åŒ–åŠŸèƒ½
        async function createTransactionTestData() {
            const result = await makeRequest(`${API_BASE}/transactions/test-data`, { method: 'POST' });
            displayResult('initResult', result);
        }

        async function createBlacklistTestData() {
            const result = await makeRequest(`${API_BASE}/blacklist/test-data`, { method: 'POST' });
            displayResult('initResult', result);
        }

        async function checkHealth() {
            const result = await makeRequest(`${API_BASE}/transactions/health`);
            displayResult('initResult', result);
        }

        async function getAllEndpoints() {
            const endpoints = [
                'GET /api/transactions/{transactionId}',
                'GET /api/transactions/user/{userId}',
                'GET /api/transactions/account/{accountNumber}',
                'GET /api/transactions/user/{userId}/page',
                'POST /api/transactions',
                'PUT /api/transactions/{transactionId}/status',
                'GET /api/blacklist/check/user/{userId}',
                'GET /api/blacklist/check/account/{accountNumber}',
                'GET /api/blacklist/user/{userId}',
                'GET /api/blacklist/account/{accountNumber}',
                'GET /api/blacklist/type/{blacklistType}',
                'GET /api/blacklist/active',
                'POST /api/blacklist',
                'PUT /api/blacklist/{id}/status',
                'GET /api/test/transactions',
                'GET /api/test/blacklist',
                'GET /api/test/comprehensive',
                'GET /api/monitor/performance',
                'GET /api/monitor/cache',
                'GET /api/monitor/health',
                'GET /api/monitor/clear-stats'
            ];
            const element = document.getElementById('initResult');
            element.className = 'result success';
            element.textContent = 'å¯ç”¨çš„ API ç«¯é»:\n\n' + endpoints.join('\n');
        }

        function clearAllResults() {
            document.getElementById('transactionResult').textContent = '';
            document.getElementById('blacklistResult').textContent = '';
            document.getElementById('performanceResult').textContent = '';
            document.getElementById('initResult').textContent = '';
            document.getElementById('monitorResult').textContent = '';
        }

        // é é¢åŠ è¼‰æ™‚æª¢æŸ¥æœå‹™ç‹€æ…‹
        window.onload = async function() {
            try {
                const response = await fetch(`${API_BASE}/transactions/health`);
                if (response.ok) {
                    console.log('âœ… æœå‹™é‹è¡Œæ­£å¸¸');
                } else {
                    console.log('âŒ æœå‹™é€£æ¥å¤±æ•—');
                }
            } catch (error) {
                console.log('âŒ ç„¡æ³•é€£æ¥åˆ°æœå‹™:', error.message);
            }
        };
    </script>
</body>
</html> 