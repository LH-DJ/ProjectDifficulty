# MultiLevelCache å¤šç´šç·©å­˜ç³»çµ±

## ğŸ“‹ é …ç›®æ¦‚è¿°

MultiLevelCache æ˜¯ä¸€å€‹åŸºæ–¼ Spring Boot çš„å¤šç´šç·©å­˜ç³»çµ±ï¼Œå°ˆæ³¨æ–¼æå‡ç³»çµ±æ€§èƒ½å’ŒéŸ¿æ‡‰é€Ÿåº¦ã€‚è©²ç³»çµ±æ¡ç”¨ Caffeine ä½œç‚ºæœ¬åœ°ç·©å­˜ï¼Œçµåˆ MySQL æ•¸æ“šåº«ï¼Œå¯¦ç¾äº†é«˜æ•ˆçš„æ•¸æ“šæŸ¥è©¢å’Œç·©å­˜ç®¡ç†ã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

- **å¤šç´šç·©å­˜æ¶æ§‹**: æ¡ç”¨ L1 ç·©å­˜ï¼ˆCaffeineï¼‰+ æ•¸æ“šåº«çš„å…©ç´šç·©å­˜æ¨¡å¼
- **é«˜æ€§èƒ½æŸ¥è©¢**: é€šéç·©å­˜å‘½ä¸­å¤§å¹…æå‡æŸ¥è©¢éŸ¿æ‡‰é€Ÿåº¦
- **æ™ºèƒ½ç·©å­˜ç­–ç•¥**: æ”¯æŒç·©å­˜éæœŸã€å®¹é‡é™åˆ¶ç­‰ç­–ç•¥
- **æ€§èƒ½ç›£æ§**: å…§å»ºæ€§èƒ½æ¸¬è©¦å’Œç›£æ§åŠŸèƒ½
- **ç•°æ­¥è™•ç†**: æ”¯æŒç•°æ­¥ä»»å‹™è™•ç†ï¼Œæå‡ç³»çµ±ååé‡

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

### æŠ€è¡“æ£§

- **å¾Œç«¯æ¡†æ¶**: Spring Boot 2.x
- **ç·©å­˜æ¡†æ¶**: Caffeine
- **æ•¸æ“šåº«**: MySQL 8.0
- **ORMæ¡†æ¶**: MyBatis Plus
- **æ§‹å»ºå·¥å…·**: Maven
- **æ—¥èªŒæ¡†æ¶**: SLF4J + Logback

### é …ç›®çµæ§‹

```
MultiLevelCache/
â”œâ”€â”€ src/main/java/com/multilevelcache/
â”‚   â”œâ”€â”€ aspect/                    # åˆ‡é¢é¡
â”‚   â”œâ”€â”€ cache/                     # ç·©å­˜æœå‹™
â”‚   â”œâ”€â”€ config/                    # é…ç½®é¡
â”‚   â”œâ”€â”€ controller/                # æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ dto/                       # æ•¸æ“šå‚³è¼¸å°è±¡
â”‚   â”œâ”€â”€ entity/                    # å¯¦é«”é¡
â”‚   â”œâ”€â”€ mapper/                    # æ•¸æ“šè¨ªå•å±¤
â”‚   â””â”€â”€ service/                   # æ¥­å‹™æœå‹™å±¤
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.yml            # ä¸»é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ mapper/                    # MyBatisæ˜ å°„æ–‡ä»¶
â”‚   â”œâ”€â”€ sql/                       # æ•¸æ“šåº«åˆå§‹åŒ–è…³æœ¬
â”‚   â””â”€â”€ static/                    # éœæ…‹è³‡æº
â””â”€â”€ target/                        # ç·¨è­¯è¼¸å‡ºç›®éŒ„
```

## ğŸš€ å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒè¦æ±‚

- JDK 8+
- MySQL 8.0+
- Maven 3.6+

### å®‰è£æ­¥é©Ÿ

1. **åˆå§‹åŒ–æ•¸æ“šåº«**
   ```sql
   -- åŸ·è¡Œ src/main/resources/sql/init.sql
   ```

2. **é…ç½®æ•¸æ“šåº«é€£æ¥**
   ```yaml
   # ä¿®æ”¹ src/main/resources/application.yml
   spring:
     datasource:
       url: jdbc:mysql://localhost:3306/multilevel_cache
       username: your_username
       password: your_password
   ```

3. **ç·¨è­¯é …ç›®**
   ```bash
   mvn clean package
   ```

4. **å•Ÿå‹•æ‡‰ç”¨**
   ```bash
   # Windows
   start-app.bat
   
   # æˆ–ç›´æ¥é‹è¡Œ
   java -jar target/MultiLevelCache-2.0.0.jar
   ```

### è¨ªå•åœ°å€

- **æ‡‰ç”¨é¦–é **: http://localhost:8080
- **å¥åº·æª¢æŸ¥**: http://localhost:8080/actuator/health

## ğŸ§ª æ¸¬è©¦æµç¨‹èªªæ˜

### 1. å–®å…ƒæ¸¬è©¦

#### äº¤æ˜“è¨˜éŒ„æŸ¥è©¢æ¸¬è©¦
```bash
# æ¸¬è©¦å–®å€‹äº¤æ˜“è¨˜éŒ„æŸ¥è©¢
GET /api/transactions/{transactionId}

# ç¤ºä¾‹
GET /api/transactions/TXN000001
```

#### é»‘åå–®æª¢æŸ¥æ¸¬è©¦
```bash
# æ¸¬è©¦ç”¨æˆ¶é»‘åå–®æª¢æŸ¥
GET /api/blacklist/user/{userId}

# æ¸¬è©¦è³¬æˆ¶é»‘åå–®æª¢æŸ¥
GET /api/blacklist/account/{accountNumber}

# ç¤ºä¾‹
GET /api/blacklist/user/USER001
GET /api/blacklist/account/ACC001
```

### 2. æ€§èƒ½æ¸¬è©¦

#### äº¤æ˜“è¨˜éŒ„æ€§èƒ½æ¸¬è©¦
```bash
# æ¸¬è©¦äº¤æ˜“è¨˜éŒ„æŸ¥è©¢æ€§èƒ½
GET /api/performance/test/transactions?requestCount=100&concurrentThreads=10
```

#### é»‘åå–®æ€§èƒ½æ¸¬è©¦
```bash
# æ¸¬è©¦é»‘åå–®æª¢æŸ¥æ€§èƒ½
GET /api/performance/test/blacklist?requestCount=100&concurrentThreads=10
```

#### ç¶œåˆæ€§èƒ½æ¸¬è©¦
```bash
# åŸ·è¡Œç¶œåˆæ€§èƒ½æ¸¬è©¦
GET /api/performance/test/comprehensive?requestCount=50&concurrentThreads=10
```

### 3. ç·©å­˜æ¸¬è©¦

#### ç·©å­˜å‘½ä¸­ç‡æ¸¬è©¦
1. é¦–æ¬¡æŸ¥è©¢ï¼šå¾æ•¸æ“šåº«ç²å–æ•¸æ“šä¸¦å¯«å…¥ç·©å­˜
2. å†æ¬¡æŸ¥è©¢ï¼šå¾ç·©å­˜ç›´æ¥ç²å–æ•¸æ“š
3. è§€å¯ŸéŸ¿æ‡‰æ™‚é–“å·®ç•°

#### ç·©å­˜å¤±æ•ˆæ¸¬è©¦
1. ç­‰å¾…ç·©å­˜éæœŸï¼ˆé…ç½®çš„TTLæ™‚é–“ï¼‰
2. é‡æ–°æŸ¥è©¢é©—è­‰ç·©å­˜å¤±æ•ˆ
3. ç¢ºèªæ•¸æ“šé‡æ–°å¾æ•¸æ“šåº«ç²å–

## ğŸ”„ æ ¸å¿ƒæ¥­å‹™æµç¨‹

### 1. äº¤æ˜“è¨˜éŒ„æŸ¥è©¢æµç¨‹

```mermaid
graph TD
    A[æ¥æ”¶æŸ¥è©¢è«‹æ±‚] --> B[ç”Ÿæˆç·©å­˜Key]
    B --> C[æŸ¥è©¢L1ç·©å­˜]
    C --> D{ç·©å­˜å‘½ä¸­?}
    D -->|æ˜¯| E[è¿”å›ç·©å­˜æ•¸æ“š]
    D -->|å¦| F[æŸ¥è©¢æ•¸æ“šåº«]
    F --> G[æ•¸æ“šåº«æœ‰æ•¸æ“š?]
    G -->|æ˜¯| H[å¯«å…¥ç·©å­˜]
    G -->|å¦| I[è¿”å›ç©ºçµæœ]
    H --> J[è¿”å›æ•¸æ“šåº«æ•¸æ“š]
    I --> K[çµæŸ]
    J --> K
    E --> K
```

#### è©³ç´°æ­¥é©Ÿï¼š

1. **è«‹æ±‚æ¥æ”¶**: æ¥æ”¶äº¤æ˜“IDæŸ¥è©¢è«‹æ±‚
2. **ç·©å­˜æŸ¥è©¢**: ä½¿ç”¨ `transaction:{transactionId}` ä½œç‚ºKeyæŸ¥è©¢Caffeineç·©å­˜
3. **ç·©å­˜å‘½ä¸­**: å¦‚æœç·©å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›æ•¸æ“šï¼ŒéŸ¿æ‡‰æ™‚é–“é€šå¸¸åœ¨1-5ms
4. **æ•¸æ“šåº«æŸ¥è©¢**: ç·©å­˜æœªå‘½ä¸­æ™‚ï¼ŒæŸ¥è©¢MySQLæ•¸æ“šåº«
5. **ç·©å­˜å¯«å…¥**: å°‡æ•¸æ“šåº«æŸ¥è©¢çµæœå¯«å…¥ç·©å­˜ï¼Œè¨­ç½®TTLç‚º30åˆ†é˜
6. **çµæœè¿”å›**: è¿”å›æŸ¥è©¢çµæœï¼ŒåŒ…å«ç·©å­˜ç´šåˆ¥å’ŒéŸ¿æ‡‰æ™‚é–“ä¿¡æ¯

### 2. é»‘åå–®æª¢æŸ¥æµç¨‹

```mermaid
graph TD
    A[æ¥æ”¶é»‘åå–®æª¢æŸ¥è«‹æ±‚] --> B[ç¢ºå®šæª¢æŸ¥é¡å‹]
    B --> C[ç”Ÿæˆç·©å­˜Key]
    C --> D[æŸ¥è©¢L1ç·©å­˜]
    D --> E{ç·©å­˜å‘½ä¸­?}
    E -->|æ˜¯| F[è¿”å›ç·©å­˜çµæœ]
    E -->|å¦| G[æŸ¥è©¢æ•¸æ“šåº«]
    G --> H[æ•¸æ“šåº«æœ‰è¨˜éŒ„?]
    H -->|æ˜¯| I[å¯«å…¥ç·©å­˜]
    H -->|å¦| J[è¿”å›ç„¡é»‘åå–®è¨˜éŒ„]
    I --> K[è¿”å›é»‘åå–®è¨˜éŒ„]
    F --> L[çµæŸ]
    J --> L
    K --> L
```

#### è©³ç´°æ­¥é©Ÿï¼š

1. **è«‹æ±‚æ¥æ”¶**: æ¥æ”¶ç”¨æˆ¶IDæˆ–è³¬æˆ¶è™Ÿç¢¼çš„é»‘åå–®æª¢æŸ¥è«‹æ±‚
2. **ç·©å­˜æŸ¥è©¢**: ä½¿ç”¨ `user_blacklist:{userId}` æˆ– `account_blacklist:{accountNumber}` ä½œç‚ºKey
3. **ç·©å­˜å‘½ä¸­**: å¦‚æœç·©å­˜å‘½ä¸­ï¼Œç›´æ¥è¿”å›é»‘åå–®ç‹€æ…‹
4. **æ•¸æ“šåº«æŸ¥è©¢**: ç·©å­˜æœªå‘½ä¸­æ™‚ï¼ŒæŸ¥è©¢MySQLé»‘åå–®è¡¨
5. **ç·©å­˜å¯«å…¥**: å°‡æŸ¥è©¢çµæœå¯«å…¥ç·©å­˜ï¼Œè¨­ç½®TTLç‚º60åˆ†é˜
6. **çµæœè¿”å›**: è¿”å›é»‘åå–®æª¢æŸ¥çµæœï¼ŒåŒ…å«è©³ç´°çš„é¢¨éšªä¿¡æ¯

### 3. ç·©å­˜ç®¡ç†æµç¨‹

#### ç·©å­˜é…ç½®
```yaml
cache:
  caffeine:
    transaction:
      maximum-size: 1000        # æœ€å¤§ç·©å­˜æ¢ç›®æ•¸
      expire-after-write: 30m   # å¯«å…¥å¾ŒéæœŸæ™‚é–“
      expire-after-access: 10m  # è¨ªå•å¾ŒéæœŸæ™‚é–“
    blacklist:
      maximum-size: 500         # æœ€å¤§ç·©å­˜æ¢ç›®æ•¸
      expire-after-write: 60m   # å¯«å…¥å¾ŒéæœŸæ™‚é–“
      expire-after-access: 20m  # è¨ªå•å¾ŒéæœŸæ™‚é–“
```

#### ç·©å­˜æ“ä½œ
- **è®€å–**: `cacheService.get(cacheName, key, clazz)`
- **å¯«å…¥**: `cacheService.put(cacheName, key, value)`
- **åˆªé™¤**: `cacheService.evict(cacheName, key)`
- **æ¸…ç©º**: `cacheService.clear(cacheName)`

## ğŸ’¾ å¤šç´šç·©å­˜æ‡‰ç”¨å ´æ™¯

### 1. é«˜é »æŸ¥è©¢å ´æ™¯

#### é©ç”¨å ´æ™¯
- ç”¨æˆ¶ä¿¡æ¯æŸ¥è©¢
- å•†å“ä¿¡æ¯æŸ¥è©¢
- é…ç½®ä¿¡æ¯æŸ¥è©¢
- é»‘åå–®æª¢æŸ¥

#### å¯¦ç¾æ–¹å¼
```java
// æŸ¥è©¢æµç¨‹
public TransactionDTO getTransactionById(String transactionId) {
    String cacheKey = "transaction:" + transactionId;
    
    // 1. æŸ¥è©¢L1ç·©å­˜
    Transaction cached = cacheService.get(CACHE_NAME, cacheKey, Transaction.class);
    if (cached != null) {
        return buildTransactionDTO(cached, responseTime, "L1", true);
    }
    
    // 2. æŸ¥è©¢æ•¸æ“šåº«
    Transaction transaction = transactionMapper.selectByTransactionId(transactionId);
    if (transaction != null) {
        // 3. å¯«å…¥ç·©å­˜
        cacheService.put(CACHE_NAME, cacheKey, transaction);
        return buildTransactionDTO(transaction, responseTime, "DB", false);
    }
    
    return buildTransactionDTO(null, responseTime, "DB", false);
}
```

### 2. è®€å¤šå¯«å°‘å ´æ™¯

#### é©ç”¨å ´æ™¯
- ç³»çµ±é…ç½®ä¿¡æ¯
- éœæ…‹æ•¸æ“šæŸ¥è©¢
- åƒè€ƒæ•¸æ“šæŸ¥è©¢

#### ç·©å­˜ç­–ç•¥
- **TTLç­–ç•¥**: è¨­ç½®è¼ƒé•·çš„éæœŸæ™‚é–“ï¼ˆå¦‚60åˆ†é˜ï¼‰
- **å®¹é‡ç­–ç•¥**: é™åˆ¶ç·©å­˜å¤§å°ï¼Œé¿å…å…§å­˜æº¢å‡º
- **æ›´æ–°ç­–ç•¥**: æ•¸æ“šè®Šæ›´æ™‚ä¸»å‹•æ¸…é™¤ç·©å­˜

### 3. ä¸¦ç™¼é«˜è¨ªå•å ´æ™¯

#### é©ç”¨å ´æ™¯
- ç†±é»æ•¸æ“šæŸ¥è©¢
- å¯¦æ™‚æ•¸æ“šå±•ç¤º
- ç”¨æˆ¶æœƒè©±ä¿¡æ¯

#### æ€§èƒ½å„ªåŒ–
```java
// ç•°æ­¥ç·©å­˜æ›´æ–°
@Async("cacheExecutor")
public CompletableFuture<Void> updateCacheAsync(String key, Object value) {
    cacheService.put(CACHE_NAME, key, value);
    return CompletableFuture.completedFuture(null);
}
```

### 4. æ•¸æ“šä¸€è‡´æ€§å ´æ™¯

#### é©ç”¨å ´æ™¯
- é‡‘èäº¤æ˜“è¨˜éŒ„
- ç”¨æˆ¶è³¬æˆ¶ä¿¡æ¯
- æ•æ„Ÿæ•¸æ“šæŸ¥è©¢

#### ä¸€è‡´æ€§ä¿è­‰
- **ç·©å­˜å¤±æ•ˆ**: æ•¸æ“šæ›´æ–°æ™‚ä¸»å‹•æ¸…é™¤ç›¸é—œç·©å­˜
- **TTLæ§åˆ¶**: è¨­ç½®åˆç†çš„éæœŸæ™‚é–“
- **æ•¸æ“šé©—è­‰**: é—œéµæ•¸æ“šå¾æ•¸æ“šåº«é‡æ–°é©—è­‰

## ğŸ“Š æ€§èƒ½ç›£æ§

### 1. éŸ¿æ‡‰æ™‚é–“ç›£æ§

ç³»çµ±æä¾›è©³ç´°çš„éŸ¿æ‡‰æ™‚é–“çµ±è¨ˆï¼š
- å¹³å‡éŸ¿æ‡‰æ™‚é–“
- æœ€å°/æœ€å¤§éŸ¿æ‡‰æ™‚é–“
- 95%åˆ†ä½æ•¸éŸ¿æ‡‰æ™‚é–“
- ä¸­ä½æ•¸éŸ¿æ‡‰æ™‚é–“

### 2. ç·©å­˜å‘½ä¸­ç‡ç›£æ§

é€šéAPIéŸ¿æ‡‰ä¸­çš„ `fromCache` å­—æ®µç›£æ§ç·©å­˜å‘½ä¸­ç‡ï¼š
- `true`: æ•¸æ“šä¾†è‡ªç·©å­˜
- `false`: æ•¸æ“šä¾†è‡ªæ•¸æ“šåº«

### 3. ç³»çµ±å¥åº·æª¢æŸ¥

```bash
# å¥åº·æª¢æŸ¥
GET /actuator/health

# ç·©å­˜çµ±è¨ˆ
GET /actuator/caches
```

## ğŸ”§ é…ç½®èªªæ˜

### æ•¸æ“šåº«é…ç½®
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/multilevel_cache
    username: root
    password: your_password
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
```

### ç·©å­˜é…ç½®
```yaml
cache:
  caffeine:
    transaction:
      maximum-size: 1000
      expire-after-write: 30m
      expire-after-access: 10m
    blacklist:
      maximum-size: 500
      expire-after-write: 60m
      expire-after-access: 20m
```

### æ—¥èªŒé…ç½®
```yaml
logging:
  level:
    com.multilevelcache: debug
    root: info
```

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

1. **ç·©å­˜æœªç”Ÿæ•ˆ**
   - æª¢æŸ¥ç·©å­˜é…ç½®æ˜¯å¦æ­£ç¢º
   - ç¢ºèªç·©å­˜Keyç”Ÿæˆé‚è¼¯
   - æŸ¥çœ‹æ—¥èªŒä¸­çš„ç·©å­˜æ“ä½œè¨˜éŒ„

2. **æ€§èƒ½æœªæå‡**
   - æª¢æŸ¥ç·©å­˜å‘½ä¸­ç‡
   - åˆ†æéŸ¿æ‡‰æ™‚é–“çµ±è¨ˆ
   - ç¢ºèªæ•¸æ“šåº«æŸ¥è©¢æ•ˆç‡

3. **å…§å­˜ä½¿ç”¨éé«˜**
   - èª¿æ•´ç·©å­˜æœ€å¤§å®¹é‡
   - ç¸®çŸ­ç·©å­˜éæœŸæ™‚é–“
   - ç›£æ§ç·©å­˜çµ±è¨ˆä¿¡æ¯

### èª¿å„ªå»ºè­°

1. **ç·©å­˜å®¹é‡èª¿å„ª**
   - æ ¹æ“šå…§å­˜ä½¿ç”¨æƒ…æ³èª¿æ•´ `maximum-size`
   - ç›£æ§ç·©å­˜æ·˜æ±°çµ±è¨ˆ

2. **éæœŸæ™‚é–“èª¿å„ª**
   - æ ¹æ“šæ•¸æ“šæ›´æ–°é »ç‡èª¿æ•´TTL
   - å¹³è¡¡æ•¸æ“šä¸€è‡´æ€§å’Œæ€§èƒ½

3. **ä¸¦ç™¼é…ç½®èª¿å„ª**
   - æ ¹æ“šç³»çµ±è² è¼‰èª¿æ•´ç·šç¨‹æ± å¤§å°
   - ç›£æ§ç·šç¨‹æ± ä½¿ç”¨æƒ…æ³

## ğŸ“ æ›´æ–°æ—¥èªŒ

### v2.0.0
- å¯¦ç¾å¤šç´šç·©å­˜æ¶æ§‹
- æ·»åŠ æ€§èƒ½æ¸¬è©¦åŠŸèƒ½
- å®Œå–„ç›£æ§å’Œæ—¥èªŒ
- å„ªåŒ–ç·©å­˜ç­–ç•¥

### v1.0.0
- åŸºç¤ç·©å­˜åŠŸèƒ½
- äº¤æ˜“è¨˜éŒ„æŸ¥è©¢
- é»‘åå–®æª¢æŸ¥

## ğŸ¤ è²¢ç»æŒ‡å—

1. Fork é …ç›®
2. å‰µå»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤è®Šæ›´
4. ç™¼èµ· Pull Request

## ğŸ“„ è¨±å¯è­‰

æœ¬é …ç›®æ¡ç”¨ MIT è¨±å¯è­‰ - è©³è¦‹ [LICENSE](LICENSE) æ–‡ä»¶

---

**MultiLevelCache Team** - å°ˆæ³¨æ–¼é«˜æ€§èƒ½ç·©å­˜è§£æ±ºæ–¹æ¡ˆ 